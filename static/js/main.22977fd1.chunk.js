(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{42:function(e,t,n){e.exports=n(59)},47:function(e,t,n){},59:function(e,t,n){"use strict";n.r(t);var o=n(1),a=n.n(o),r=n(34),c=(n(47),n(63)),i=n(65),u=n(66),s=n(24),l=n(19),p=n(39),f=n(20),d="GET_USER_LOCATION",m="HANDLE_IMAGE_UPLOAD",g="HANDLE_REPORT_UPLOAD",E={status:"UPLOAD",coords:{lat:37.8131418,lng:-122.2662702},img_url:null},h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E,t=arguments.length>1?arguments[1]:void 0,n=t.type,o=t.payload;switch(n){case"SET_REPORT_STATUS":return Object(f.a)({},e,{status:o});case"SET_REPORT_IMAGE":return Object(f.a)({},e,{img_url:o});case"SET_REPORT_COORDS":return console.log("SET_REPORT_COORDS:",o),Object(f.a)({},e,{coords:o});default:return e}},O=n(17),v=n.n(O),b=n(18),w=function(e){return{type:"SET_REPORT_IMAGE",payload:e}},R=function(e){return{type:"SET_REPORT_COORDS",payload:e}},S="https://s3-us-west-1.amazonaws.com/oak-bike/",j=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(t,n){console.log("getUserLocation effect"),navigator.geolocation.getCurrentPosition(function(e){return t(e)},function(e){return n(e)},e)})},k=function(e){return new Promise(function(t,n){console.log("doUploadImage, image:",e);var o=e.type.split("/")[1],a="".concat(function(){for(var e="",t=0;t<24;t+=1)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return e}(),".").concat(o),r=new FormData;r.append("key",a),r.append("file",e),fetch(S,{method:"POST",body:r}).then(function(){return t("".concat(S).concat(a))}).catch(function(e){return n(e)})})},y=function(e){return new Promise(function(t,n){fetch("https://oakbike.herokuapp.com/gql",{method:"POST",body:e}).then(function(e){return t(e)}).catch(function(e){return n(e)})})},T=v.a.mark(_),L=v.a.mark(x),P=v.a.mark(C),A=v.a.mark(D);function _(){var e;return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("handleGetUserLocation"),t.prev=1,t.next=4,Object(b.a)(j);case 4:return e=t.sent,console.log("success"),t.next=8,Object(b.b)(R({lat:e.coords.latitude,lng:e.coords.longitude}));case 8:t.next=13;break;case 10:t.prev=10,t.t0=t.catch(1),console.error("ERROR: ".concat(t.t0.message));case 13:case"end":return t.stop()}},T,this,[[1,10]])}function x(e){var t;return v.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,console.log("handleImageUpload action:",e),n.next=4,Object(b.a)(k,e.payload);case 4:return t=n.sent,console.log("upload successful:",e.payload,"\n\n",t),n.next=8,Object(b.b)(w(t));case 8:n.next=13;break;case 10:n.prev=10,n.t0=n.catch(0),console.error("ERROR: ".concat(n.t0.message));case 13:case"end":return n.stop()}},L,this,[[0,10]])}function C(e){var t;return v.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Object(b.a)(y,e.payload);case 3:t=n.sent,console.log("REPORT UPLOADED\n\n",e.payload,"\n\n",t),n.next=10;break;case 7:n.prev=7,n.t0=n.catch(0),console.error("ERROR: ".concat(n.t0.message));case 10:case"end":return n.stop()}},P,this,[[0,7]])}function D(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(b.c)(d,_);case 2:return e.next=4,Object(b.c)(m,x);case 4:return e.next=6,Object(b.c)(g,C);case 6:case"end":return e.stop()}},A,this)}var I=D,U=Object(p.a)(),N=Object(l.c)({report:h}),M=Object(l.e)(N,Object(l.a)(U));U.run(I);var z=M,W=n(61),G=function(){return a.a.createElement("div",null,a.a.createElement("h1",null,"Home Page"),a.a.createElement("ul",null,a.a.createElement("li",null,a.a.createElement(W.a,{to:"/report"},"Report Obstruction")),a.a.createElement("li",null,a.a.createElement(W.a,{to:"/nopers"},"Bad Link"))))},H=function(){return a.a.createElement("div",null,a.a.createElement("p",null,"gosh darn we got us a 404 page not heckin found"))},B=n(27),F=function(e){return e.report||{}},Z=Object(B.a)(F,function(e){return e.status}),J=Object(B.a)(F,function(e){return e.img_url}),q=Object(B.a)(F,function(e){return console.log(Object(f.a)({},e.coords)),Object(f.a)({},e.coords)}),K=n(40),Q=function(e){var t=e.uploadImage,n=e.setStatus;return a.a.createElement(a.a.Fragment,null,a.a.createElement("p",null,"Upload:"),a.a.createElement(K.a,{onDrop:function(e){t(e[0]),n("LOCATION")}},function(e){var t=e.getRootProps,n=e.getInputProps,o=e.isDragActive;return a.a.createElement("div",Object.assign({},t(),{className:"dropzone ".concat(o?"dropzone--isActive":"")}),a.a.createElement("input",n()),o?a.a.createElement("p",null,"Drop files here..."):a.a.createElement("p",null,"Try dropping some files here, or click to select files to upload."))}))},V=n(28),X=n(64),Y=n(67),$=n(62),ee=function(e){var t=e.initZoom,n=e.coords,r=e.setStatus,c=e.setCoords,i=e.getLocation,u=Object(o.useState)(document.documentElement.clientHeight-60),s=Object(V.a)(u,2),l=s[0],p=s[1];Object(o.useEffect)(function(){var e=function(){p(document.documentElement.clientHeight-60)};return window.addEventListener("resize",e),e(),function(){window.removeEventListener("resize",e)}},[]);var f=Object(o.useState)(n),d=Object(V.a)(f,2),m=d[0],g=d[1];Object(o.useEffect)(function(){g(n)},[n]);var E=Object(o.useState)(t),h=Object(V.a)(E,2),O=h[0],v=h[1];Object(o.useEffect)(function(){console.log("useEffect getLocation"),i()},[]);return a.a.createElement(a.a.Fragment,null,a.a.createElement(X.a,{center:m,zoom:O,onDrag:function(e){g(e.target.getCenter())},onZoom:function(e){v(e.target.getZoom())},style:{height:l}},a.a.createElement(Y.a,{attribution:'&copy <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),a.a.createElement($.a,{position:m})),a.a.createElement("button",{onClick:function(){c(m),r("DETAILS")}},"Save Location"))},te=function(e){var t=e.image,n=e.coords,o=e.uploadReport;return a.a.createElement(a.a.Fragment,null,a.a.createElement("p",null,"image: ",t),a.a.createElement("p",null,"coords: [",n.lat,", ",n.lng,"]"),a.a.createElement("p",null,a.a.createElement("button",{onClick:function(){return o()}},"upload report")))},ne=function(e){var t=e.status,n=e.image,o=e.coords,r=e.setStatus,c=e.setCoords,i=e.getLocation,u=e.uploadImage,s=e.uploadReport;switch(t){case"UPLOAD":return a.a.createElement(Q,{uploadImage:u,setStatus:r});case"LOCATION":return a.a.createElement(ee,{initZoom:14,coords:o,setStatus:r,setCoords:c,getLocation:i});case"DETAILS":return a.a.createElement(te,{image:n,coords:o,uploadReport:s});case"SUBMISSION":case"COMPLETE":return a.a.createElement("p",null,"...");default:return null}},oe=Object(s.b)(function(e){return{status:Z(e),image:J(e),coords:q(e)}},function(e){return{setStatus:function(t){return e(function(e){return{type:"SET_REPORT_STATUS",payload:e}}(t))},setCoords:function(t){return e(R(t))},getLocation:function(){return e({type:d})},uploadImage:function(t){return e(function(e){return{type:m,payload:e}}(t))},uploadReport:function(t){return e(function(e){return{type:g,payload:e}}(t))}}})(ne),ae=function(){return a.a.createElement(s.a,{store:z},a.a.createElement(c.a,{basename:"/oak-bike-client"},a.a.createElement(i.a,null,a.a.createElement(u.a,{exact:!0,path:"/",component:G}),a.a.createElement(u.a,{path:"/report",component:oe}),a.a.createElement(u.a,{path:"/*",component:H}))))},re=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ce(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}Object(r.render)(a.a.createElement(ae,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/oak-bike-client",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/oak-bike-client","/service-worker.js");re?(function(e,t){fetch(e).then(function(n){var o=n.headers.get("content-type");404===n.status||null!=o&&-1===o.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):ce(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA")})):ce(t,e)})}}()}},[[42,1,2]]]);
//# sourceMappingURL=main.22977fd1.chunk.js.map